<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Siddhivinayak Digital — Home</title>
</head>
<body>
  <header>
    <h1>Siddhivinayak Digital</h1>
    <p>Your trusted digital printing & services partner</p>
  </header>

  <div class="big-title">Siddhivinayak Digital</div>
  <div class="tagline">Printing • Xerox • Binding • Lamination • Designing</div>

  <!-- Login link goes to login.html, not index.html -->
  <a id="loginLink" href="login.html">Login</a>
  <button id="logoutBtn" style="display:none;">Logout</button>

  <!-- Supabase library + config -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/supabase-config.js"></script>

  <script>
    const logoutBtn = document.getElementById("logoutBtn");

    async function checkSession() {
      const { data: { session }, error } = await supabaseClient.auth.getSession();
      if (error) {
        console.error("Session error:", error.message);
        return;
      }
      if (!session) {
        // No active session → show login link
        document.getElementById("loginLink").style.display = "inline-block";
        logoutBtn.style.display = "none";
        return;
      }

      // Session exists → check role
      const userId = session.user.id;
      const { data: profile, error: pErr } = await supabaseClient
        .from("profiles")
        .select("role")
        .eq("id", userId)
        .single();

      if (pErr) {
        console.error("Profile error:", pErr.message);
        return;
      }

      if (profile?.role === "admin") {
        window.location.href = "admin-dashboard.html";
      } else {
        window.location.href = "user-home.html";
      }
    }

    logoutBtn.addEventListener("click", async () => {
      const { error } = await supabaseClient.auth.signOut();
      if (error) {
        alert("Logout error: " + error.message);
        return;
      }
      alert("Logged out successfully");
      document.getElementById("loginLink").style.display = "inline-block";
      logoutBtn.style.display = "none";
    });

    // Run session check on page load
    checkSession();
  </script>
</body>
</html>
