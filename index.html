<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Welcome to Sidhivinayak Digital</title>
</head>
<body>
  <h2>Welcome to Sidhivinayak Digital</h2>
  <div id="user-info">Loading user...</div>
  <div id="datetime"></div>

  <form id="order-form">
    <input type="text" id="cust_name" placeholder="Customer Name" required>
    <input type="text" id="job_description" placeholder="Job Description" required>
    <input type="number" id="total_amount" placeholder="Total Amount" required>
    <button type="submit">Save Order</button>
  </form>

  <h3>Orders in Queue</h3>
  <table border="1">
    <thead><tr><th>ID</th><th>Name</th><th>Job</th><th>Total</th></tr></thead>
    <tbody id="orders-body"></tbody>
  </table>

  <div id="toast"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const { createClient } = supabase;
    const supabaseUrl = "https://qcyqjcxzytjtsikzrdyv.supabase.co";
    const supabaseKey = "YOUR_ANON_KEY"; // replace with your anon key
    const supabaseClient = createClient(supabaseUrl, supabaseKey);

    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.textContent = msg;
      toast.style.display = "block";
      setTimeout(() => toast.style.display = "none", 2000);
    }

    async function loadOrders() {
      const { data, error } = await supabaseClient.from("orders").select("*").order("order_id");
      if (error) { console.error(error); return; }
      const tbody = document.getElementById("orders-body");
      tbody.innerHTML = "";
      data.forEach(o => {
        tbody.innerHTML += `<tr><td>${o.order_id}</td><td>${o.cust_name}</td><td>${o.job_description}</td><td>â‚¹${o.total_amount}</td></tr>`;
      });
    }

    document.getElementById("order-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const cust_name = document.getElementById("cust_name").value;
      const job_description = document.getElementById("job_description").value;
      const total_amount = parseFloat(document.getElementById("total_amount").value);
      const { error } = await supabaseClient.from("orders").insert([{ cust_name, job_description, total_amount }]);
      if (error) { showToast("Error saving order"); }
      else { showToast("Order submitted"); loadOrders(); e.target.reset(); }
    });

    loadOrders();
  </script>
</body>
</html>
