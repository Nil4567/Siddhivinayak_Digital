<!doctype html>
<html>
<head><meta charset="utf-8"><title>Settings</title><link rel="stylesheet" href="../styles/internal.css"></head>
<body>
  <div class="topbar"><div class="brand">Siddhivinayak Digital</div><div class="controls"><div id="sv_user_name"></div><button class="btn" onclick="logout()">Logout</button></div></div>

  <div class="app">
    <aside class="sidebar">
      <div class="brand-small">Settings</div>
      <a href="dashboard.html" class="nav-link">Dashboard</a>
      <a href="settings.html" class="nav-link active">Settings</a>
    </aside>

    <main class="main">
      <div class="page-header"><div><div class="page-title">Admin Settings</div><div class="page-sub">User management & backups</div></div></div>

      <div class="card">
        <h3>User Management (JSON)</h3>
        <p>This UI edits local users.json (note: editing GitHub data file requires Git operations â€” here we allow demo edit stored in localStorage)</p>

        <div style="margin-top:12px">
          <label>Username</label>
          <input id="u_username" type="text" placeholder="username">
          <label>Password</label>
          <input id="u_password" type="text" placeholder="password">
          <label>Role</label>
          <select id="u_role"><option value="user">user</option><option value="admin">admin</option></select>
          <div style="margin-top:10px">
            <button class="btn" onclick="addUserLocal()">Add User (local)</button>
            <button class="btn secondary" onclick="renderUsers()">Refresh</button>
          </div>
        </div>

        <div style="margin-top:18px">
          <h4>Local users (demo)</h4>
          <table class="table" id="usersTable"><thead><tr><th>username</th><th>role</th></tr></thead><tbody></tbody></table>
        </div>

      </div>

    </main>
  </div>

  <script src="../script.js"></script>
  <script>
    checkAuth(true); // require admin
    function getLocalUsers(){ return JSON.parse(localStorage.getItem('sv_users')||'[]'); }
    function saveLocalUsers(a){ localStorage.setItem('sv_users', JSON.stringify(a)); }
    function addUserLocal(){
      const u = document.getElementById('u_username').value.trim();
      const p = document.getElementById('u_password').value || 'password123';
      const role = document.getElementById('u_role').value;
      if(!u) { alert('username required'); return; }
      const arr = getLocalUsers();
      arr.push({username:u, password_b64: btoa(p), role:role, name:u, department:''});
      saveLocalUsers(arr);
      renderUsers();
      document.getElementById('u_username').value=''; document.getElementById('u_password').value='';
    }
    function renderUsers(){
      const tbody = document.querySelector('#usersTable tbody');
      const arr = getLocalUsers();
      tbody.innerHTML = '';
      if(arr.length===0) tbody.innerHTML = '<tr><td colspan="2" class="muted">No local users (demo)</td></tr>';
      arr.forEach(u=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${u.username}</td><td>${u.role}</td>`;
        tbody.appendChild(tr);
      });
    }
    renderUsers();
  </script>
</body>
</html>
