<script src="../script.js"></script>
<script src="../script-github.js"></script>

<script>
  checkLogin(); // ðŸ”¥ FIXED â€“ correct function name from script.js

  function genId() {
    return 'J-' + Date.now().toString().slice(-6);
  }

  document.getElementById("jobForm").addEventListener("submit", async function(ev) {
    ev.preventDefault();

    const job = {
      id: genId(),
      date: new Date().toISOString(),
      customer: document.getElementById('custName').value,
      contact: document.getElementById('custContact').value,
      jobType: document.getElementById('jobType').value,
      qty: Number(document.getElementById('qty').value) || 1,
      department: document.getElementById('department').value,
      urgency: document.getElementById('urgency').value,
      notes: document.getElementById('notes').value,
      status: "Pending",
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    };

    // ðŸ”¥ Send to GitHub (via workflow trigger)
    const ok = await sendJobToGitHub(job);

    if (ok) {
      alert("Job created and synced: " + job.id);
      window.location.href = "job-queue.html";
    } else {
      alert("Failed to send job to GitHub. Check console.");
    }
  });
</script>
