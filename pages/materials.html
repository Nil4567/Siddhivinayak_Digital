<!doctype html>
<html>
<head><meta charset="utf-8"><title>Materials</title><link rel="stylesheet" href="../styles/internal.css"></head>
<body>
  <div class="topbar">
    <div class="brand">Siddhivinayak Digital</div>
    <div class="controls"><div id="sv_user_name"></div><button class="btn" onclick="logout()">Logout</button></div>
  </div>

  <div class="app">
    <aside class="sidebar">
      <div class="brand-small">Materials</div>
      <a href="dashboard.html" class="nav-link">Dashboard</a>
      <a href="materials.html" class="nav-link active">Materials</a>
    </aside>

    <main class="main">
      <div class="page-header"><div><div class="page-title">Materials & Consumables</div><div class="page-sub">Track paper, ink and supplies</div></div></div>

      <div class="card">
        <form id="matForm">
          <div class="form-row">
            <div class="field">
              <label>Item name</label>
              <input id="matName" type="text">
            </div>
            <div class="field">
              <label>Quantity</label>
              <input id="matQty" type="number" value="0">
            </div>
          </div>
          <div style="display:flex;gap:10px">
            <button class="btn" type="submit">Add / Update</button>
            <button class="btn secondary" type="button" onclick="renderMats()">Refresh</button>
          </div>
        </form>
      </div>

      <div class="card" style="margin-top:14px">
        <h3>Inventory</h3>
        <table class="table" id="matTable"><thead><tr><th>Item</th><th>Qty</th></tr></thead><tbody></tbody></table>
      </div>
    </main>
  </div>

  <script src="../script.js"></script>
  <script>
    checkAuth();
    function getMats(){ return JSON.parse(localStorage.getItem('sv_mats')||'[]'); }
    function saveMats(a){ localStorage.setItem('sv_mats', JSON.stringify(a)); }
    document.getElementById('matForm').addEventListener('submit', function(ev){
      ev.preventDefault();
      const name = document.getElementById('matName').value.trim();
      const qty = Number(document.getElementById('matQty').value) || 0;
      if(!name){ alert('Enter item name'); return; }
      const mats = getMats();
      const found = mats.find(m=> m.name.toLowerCase()===name.toLowerCase());
      if(found){ found.qty = qty; } else { mats.push({name, qty}); }
      saveMats(mats);
      renderMats();
      document.getElementById('matName').value=''; document.getElementById('matQty').value=0;
    });

    function renderMats(){
      const tbody = document.querySelector('#matTable tbody');
      const mats = getMats();
      tbody.innerHTML = '';
      if(mats.length===0) tbody.innerHTML = '<tr><td colspan="2" class="muted">No items</td></tr>';
      mats.forEach(m=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${m.name}</td><td>${m.qty}</td>`;
        tbody.appendChild(tr);
      });
    }
    renderMats();
  </script>
</body>
</html>
