<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Final Bill - Siddhivinayak Digital</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- =========================================================
  IMPORTANT (COPY THIS TO COMPLETED ORDERS PAGE)
  Bill Token CLICK LOGIC (Frontend Only)
=========================================================

document.querySelectorAll(".tokenBtn").forEach(btn => {
  btn.addEventListener("click", () => {
    const row = btn.closest("tr");

    const billData = {
      order_code: row.children[0].textContent.trim(),
      customer_name: row.children[1].textContent.trim(),
      customer_contact: row.children[2].textContent.trim(),
      job_description: row.children[3].textContent.trim(),
      total_amount: parseFloat(row.children[4].textContent) || 0,
      advance_amount: parseFloat(row.children[5].textContent) || 0,
      pending_received:
        parseFloat(row.querySelector(".pendingInput")?.value) || 0,
      created_at: row.children[7].textContent,
      completed_at: row.children[8].textContent
    };

    localStorage.setItem("billData", JSON.stringify(billData));
    window.open("final-bill.html", "_blank");
  });
});

========================================================= -->

<style>
body{
  font-family:Segoe UI,Arial,sans-serif;
  background:#f4f6f9;
  margin:0;
  padding:40px;
  display:flex;
  justify-content:center;
}
.bill{
  width:650px;
  background:#fff;
  border:2px solid #333;
  padding:20px;
  box-shadow:0 4px 10px rgba(0,0,0,.2);
}
.headerRow{display:flex;gap:20px;align-items:center}
.logoWrap{width:120px;height:120px;border:1px solid #ddd;border-radius:6px}
.logoWrap img{width:100%;height:100%;object-fit:contain}
.shopInfo{text-align:center;flex:1}
.shopInfo h2{margin:0;color:#0073ff;font-size:30px}
hr{border-top:1px dashed #aaa;margin:12px 0}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:8px;font-size:14px}
th{background:#f1f9ff;width:40%;text-align:left}
.summaryBox{
  margin-top:15px;
  display:flex;
  justify-content:space-between;
  background:#f1f9ff;
  border:1px solid #0073ff;
  border-radius:6px;
  padding:10px;
  font-weight:bold;
}
.actions{margin-top:15px;display:flex;gap:8px}
.actions button{
  flex:1;
  padding:8px;
  background:#0073ff;
  color:#fff;
  border:none;
  border-radius:4px;
  cursor:pointer;
}
.thankyouBanner{
  margin-top:20px;
  background:#2ecc71;
  color:#fff;
  text-align:center;
  padding:12px;
  font-weight:bold;
  border-radius:6px;
}
</style>
</head>

<body>
<div class="bill" id="billCard">

<div class="headerRow">
  <div class="logoWrap">
    <img src="YOUR_LOGO_URL">
  </div>
  <div class="shopInfo">
    <h2>Siddhivinayak Digital</h2>
    <p>
      Row House No.3, Sundarvan CHS<br>
      OPP Datta Meghe College, Airoli<br>
      Sector-2, Navi Mumbai-400708<br>
      <strong>Contact:</strong> 8169040864
    </p>
  </div>
</div>

<hr>

<table>
<tr><th>Bill No</th><td id="billNo">‚Äî</td></tr>
<tr><th>Customer</th><td id="customer">‚Äî</td></tr>
<tr><th>Mobile</th><td id="mobile">‚Äî</td></tr>
<tr><th>Job</th><td id="job">‚Äî</td></tr>
<tr><th>Total Amount</th><td id="total">‚Çπ0.00</td></tr>
<tr><th>Advance Paid</th><td id="advance">‚Çπ0.00</td></tr>
<tr><th>Total Received</th><td id="totalReceived">‚Çπ0.00</td></tr>
<tr><th>Pending Balance</th><td id="pending">‚Çπ0.00</td></tr>
<tr><th>Order Date</th><td id="orderDate">‚Äî</td></tr>
<tr><th>Completed Date</th><td id="completedDate">‚Äî</td></tr>
</table>

<div class="summaryBox">
  <div>Pending Balance: ‚Çπ<span id="pendingSum">0.00</span></div>
  <div>Total Received: ‚Çπ<span id="receivedSum">0.00</span></div>
</div>

<div class="actions">
  <button id="printBtn">Print / PDF</button>
  <button id="downloadBtn">Download PNG</button>
  <button id="shareBtn">Share Bill</button>
</div>

<div class="thankyouBanner">
üôè Thank you for choosing Siddhivinayak Digital
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
const $ = id => document.getElementById(id);
const hide = () => $(".actions").style.display="none";
const show = () => $(".actions").style.display="flex";
const money = v => (parseFloat(v)||0).toFixed(2);

/* LOAD DATA FROM FRONTEND */
const data = JSON.parse(localStorage.getItem("billData") || "{}");

const total = data.total_amount || 0;
const advance = data.advance_amount || 0;
const pendingReceived = data.pending_received || 0;
const totalReceived = advance + pendingReceived;
const pending = Math.max(0, total - totalReceived);

$("billNo").textContent = data.order_code || "‚Äî";
$("customer").textContent = data.customer_name || "‚Äî";
$("mobile").textContent = data.customer_contact || "‚Äî";
$("job").textContent = data.job_description || "‚Äî";
$("total").textContent = "‚Çπ"+money(total);
$("advance").textContent = "‚Çπ"+money(advance);
$("totalReceived").textContent = "‚Çπ"+money(totalReceived);
$("pending").textContent = "‚Çπ"+money(pending);
$("pendingSum").textContent = money(pending);
$("receivedSum").textContent = money(totalReceived);
$("orderDate").textContent = data.created_at || "‚Äî";
$("completedDate").textContent = data.completed_at || "‚Äî";

/* PRINT */
$("printBtn").onclick = async ()=>{
  hide(); await new Promise(r=>setTimeout(r,100));
  window.print(); show();
};

/* DOWNLOAD PNG */
$("downloadBtn").onclick = async ()=>{
  hide(); await new Promise(r=>requestAnimationFrame(r));
  const c = await html2canvas($("billCard"),{scale:2});
  show();
  c.toBlob(b=>{
    const a=document.createElement("a");
    a.href=URL.createObjectURL(b);
    a.download="Siddhivinayak-Bill.png";
    a.click();
  });
};

/* SHARE PNG */
$("shareBtn").onclick = async ()=>{
  hide(); await new Promise(r=>requestAnimationFrame(r));
  const c = await html2canvas($("billCard"),{scale:2});
  show();
  c.toBlob(async b=>{
    const f=new File([b],"Siddhivinayak-Bill.png",{type:"image/png"});
    if(navigator.canShare && navigator.canShare({files:[f]})){
      await navigator.share({files:[f]});
    }else{
      const a=document.createElement("a");
      a.href=URL.createObjectURL(b);
      a.download=f.name;
      a.click();
    }
  });
};
</script>
</body>
</html>
