<script>
  document.getElementById("orderForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const order = {
      customer_name: document.getElementById("custName").value,
      customer_contact: document.getElementById("custMobile").value,
      job_description: document.getElementById("jobDesc").value,
      total_amount: parseFloat(document.getElementById("totalAmount").value),
      advance_amount: parseFloat(document.getElementById("advanceAmount").value),
      created_by: localStorage.getItem("uid"), // must match auth.uid()
      status: "Pending"
    };

    try {
      const { data, error } = await supabaseClient
        .from("orders")
        .insert([order])
        .select("order_code"); // fetch auto-generated order_code

      if (error) {
        alert("Error submitting order: " + error.message);
      } else {
        alert("Order created successfully! Code: " + data[0].order_code);
        document.getElementById("orderForm").reset();
        document.getElementById("orderDate").value = new Date().toISOString().split("T")[0];
        document.getElementById("pendingAmount").value = "";
      }
    } catch (err) {
      alert("Unexpected error: " + err.message);
    }
  });
</script>
