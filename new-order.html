<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Create New Order - Siddhivinayak Digital</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f9; margin:0; padding:20px; }
    h1 { color:#2c3e50; }
    form { background:#fff; padding:20px; border-radius:8px; max-width:500px; margin:auto; }
    label { display:block; margin-top:10px; font-weight:bold; }
    input, textarea { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:4px; }
    button { margin-top:15px; padding:10px 18px; background:#0073ff; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:600; }
    button:hover { background:#0056b3; }
  </style>
</head>
<body>
  <h1>Create New Order</h1>

  <form id="orderForm">
    <label>Customer Name *</label>
    <input type="text" id="custName" required />

    <label>Customer Contact</label>
    <input type="text" id="custMobile" />

    <label>Job Description *</label>
    <textarea id="jobDesc" required></textarea>

    <label>Total Amount</label>
    <input type="number" id="totalAmount" step="0.01" />

    <label>Advance Amount</label>
    <input type="number" id="advanceAmount" step="0.01" />

    <label>Order Date</label>
    <input type="date" id="orderDate" />

    <button type="submit">Submit Order</button>
  </form>

  <!-- Supabase SDK + Config -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/supabase-config.js"></script>

  <script>
    // Auto-populate order date with today's date
    document.getElementById("orderDate").value = new Date().toISOString().split("T")[0];

    document.getElementById("orderForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const order = {
        customer_name: document.getElementById("custName").value,
        customer_contact: document.getElementById("custMobile").value,
        job_description: document.getElementById("jobDesc").value,
        total_amount: parseFloat(document.getElementById("totalAmount").value) || 0,
        advance_amount: parseFloat(document.getElementById("advanceAmount").value) || 0,
        created_by: localStorage.getItem("uid"),
        status: "Pending",
        created_at: document.getElementById("orderDate").value // allow override
      };

      try {
        const { data, error } = await supabaseClient
          .from("orders")
          .insert([order])
          .select("order_code, order_id");

        if (error) {
          alert("Error submitting order: " + error.message);
        } else {
          alert("Order created successfully!\nCode: " + data[0].order_code + "\nID: " + data[0].order_id);
          document.getElementById("orderForm").reset();
          document.getElementById("orderDate").value = new Date().toISOString().split("T")[0];
        }
      } catch (err) {
        alert("Unexpected error: " + err.message);
      }
    });
  </script>
</body>
</html>
